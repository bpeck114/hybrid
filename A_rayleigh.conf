#FILE kscao_lgs.conf
# Keck SCAO LGS circa 2023 (pre-KAPA)

__reset__         		#replace all previous entries.
__default__	      		#this file contains default setup.

#add the directory to search path for files. Relative to $MAOS_CONFIG
path = "bin"
path = "atm"

#defines simulation parameters.
include     	= "keck_sim.conf"

#AO type. 
include     	= "keck_dm_single.conf" 

#Atmospheric profile
include     	= "atm_mk13n50p_ground_detail.conf" #Mauna Kea 13N, Chun MK_OTP 'binned' model

#Wavefront sensor information. 
include     	= keck_wfs_rayleigh_strap_lbwfs.conf

#Including configurations for reconstruction (tomo/fitting)
include     	= "recon.conf"

#For debugging purpose
include     	= "dbg.conf"

#For DM fitting
include		= "fit_oa.conf"

#### BASE OVERRIDES

# Set observation location on sky
sim.zadeg     = 30    #zenith angle. moved from atm.zadeg

evl.thetax  	= [0]
evl.thetay  	= [0]
evl.fov		= 1	# this value in arcsec will scale the evl points

evl.psf		= [1]
evl.wt		= [1]

# reconstruction aglorithms choices, some outputs, and the simulation resolution.
recon.alg	= 0 #scao mvr works better than lsr; 0 = min var, 1 = least squares
recon.split	= 0
recon.psd       = 1 # compute PDDs of DM error signal.

evl.dx		= 1/32 #1/32 is needed to have enough size for short wavelength


# HYBRID OVERRIDES
powfs.hs = [21.45e3 inf inf] # 20km, otherwise through command line
#powfs.dtrat = [1 1 1 1000]

powfs.nwfs = [1 1 1] # Rayleigh, Tip-Tilt, Truth
wfs.thetax = [0 0 0] # On-axis
wfs.thetay = [0 0 0]
powfs0_llt.ox = [0] *6.5
powfs0_llt.oy = [0] *6.5

#powfs1_llt.ox = [0] *6.5
#powfs1_llt.oy = [0] *6.5

powfs.dsa = [0 -1 0]
powfs.phystep = [-1 -1 -1] # Setting to [-1 -1 -1] could reduce memory

powfs1_llt.fnprof = NapDelta20.fits # Needs to be adjusted for different altitudes
tomo.precond = 0 # Needed for hybrid (maybe also #powfs.pywfs = [])

atm.dx = 1/128 # Needs to match powfs.dx (might be needed for more actuators)
powfs.dx = [1/128 1/16 1/32]
evl.dx = 1/128 
sim.alhi = 0 #0.322 (original value), no latency

# MORE ACTUATORS ON DM
dm.dx = [0.287] # 34x34 or 1156 actuators
dm.stroke = [300.0] # ASM for VisMCAO x10
dm.iastroke = [20.0]

# FASTER
sim.dt = 1/1500
sim.dtret = 1/1500
sim.dtref = 1/1500
sim.end = 3000 # Longer (2 sec)

# CHANGING BRIGHTNESS OF GUIDESTARS (IF dm.dx changes, so do the following parameters to maintain magnitude)
#powfs.siglev = [114.042 114.042 128116.746 41.558] 
#powfs.bkgrnd = [0.1 0.1 2.603 0.001]                 
#powfs.nearecon = [242.298 242.298 1.369 202.516] 

# EXTRA (to see if it would help the error)
#powfs.pixpsa = [25 25 4 3]
#powfs.dx = [1/128 1/128 1/16 1/32]
#powfs.misregx = [0.05 0.05 0 0.42]
#powfs.misregy = [0.05 0.05 0 0.42]
#powfs.pixtheta = 
